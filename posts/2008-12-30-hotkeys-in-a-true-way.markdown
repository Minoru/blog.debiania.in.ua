---
title: Конфигурирование Hotkeys: In A True Way
published: 2008-12-30T14:47:00Z
categories: 
tags: hardware,linux
---

Недавно <b>XstyLe</b> опубликовал <a href="http://blasux.root.ua/2008/12/hotkeys.html" target="_blank">небольшую заметочку</a> по замечательной утилите hotkeys, которая уже описывалась ранее <b>virens</b>'ом в статье <a href="http://mydebianblog.blogspot.com/2006/09/blog-post_05.html">"Мультимедийные клавиатуры в Linux"</a>. Но так как статья Михаила носила очень общий характер (была кратко описана настройка hotkeys + приведены названия программ такого же класса), а XstyLe в своём посте слишком кратко описал редактирование конфигов — по сути, краеугольного камня использования утилиты — то я попытаюсь восполнить сей пробел.<br /><a name='more'></a><br />Итак, утилита hotkeys имеет два важных конфига — общесистемный <code>/etc/hotkeys.conf</code> и описание клавиатуры <code>/urs/share/hotkeys/модель_клавиатуры.def</code>. Их-то нам и надо поправить под свои нужды.<br /><br />Начнём с описания клавиатуры. В качестве примера я буду рассматривать написание конфига для своей клавиатуры — A4Tech KL-7MU. В стандартной поставке hotkeys конфига для неё нет, поэтому я написал свой, глядя на уже существующие. Сейчас мы его построчно разберём.<br /><br />Итак, добываем права рута (в консоли <code>su</code> и ввести пасс рута) и создаём файлик <code>a4tech_kl-7mu.def</code>:<br /><br /><div class="code"><code>cd /usr/share/hotkeys/ && nano a4tech_kl-7mu.def</code></div><br />Перед вами будет окно nano с пустым (пока что) конфигом–описаловом клавиатуры.<br /><br />Первым делом напишем вот это:<br /><br /><div class="code"><code>&lt;?xml version="1.0"?&gt;</code></div><br />Эта строка означает, что конфиг — это XML документ.<br /><br />Теперь добавим блок описания клавиш и команд для них:<br /><br /><div class="code"><code>&lt;definition&gt;&lt;/definition&gt;</code></div><br />Внутри секции definition у нас будут два элемента — собственно описание команд (секция config) и описание того, кто создал данный документ и как с ним связаться.<br /><br />Добавим внутрь тегов definition секцию config:<br /><br /><div class="code"><code>&lt;config model="A4Tech KL-7MU"&gt;&lt;/config&gt;</code></div><br />Как видите, всё просто. Внутри этой секции мы должны будем дописать строки, описывающие нашу клавиатуру.<br /><br />Откройте новую консоль (не рутовую!) и запустите программу xev:<br /><br /><div class="code"><code>$ xev</code></div><br />Появится окошко, на которое вам не надо обращать внимания. Сделайте окно активным (просто кликните по его заголовку) и нажмите какую–нибудь из мультимедийных клавиш. В консоли, из которой вы запускали xen, появится что–то типа такого:<br /><br /><div class="code"><code>KeyPress event, serial 34, synthetic NO, window 0x2e00001,<br />&nbsp&nbsp;&nbsp;&nbsp;root 0x6a, subw 0x0, time 31031317, (486,21), root:(1031,312),<br />&nbsp&nbsp;&nbsp;&nbsp;state 0x10, <b>keycode 160</b> (keysym 0x0, NoSymbol), same_screen YES,<br />&nbsp&nbsp;&nbsp;&nbsp;XLookupString gives 0 bytes:<br />&nbsp&nbsp;&nbsp;&nbsp;XmbLookupString gives 0 bytes:<br />&nbsp&nbsp;&nbsp;&nbsp;XFilterEvent returns: False<br /><br />KeyRelease event, serial 34, synthetic NO, window 0x2e00001,<br />&nbsp&nbsp;&nbsp;&nbsp;root 0x6a, subw 0x0, time 31031478, (486,21), root:(1031,312),<br />&nbsp&nbsp;&nbsp;&nbsp;state 0x10, <b>keycode 160</b> (keysym 0x0, NoSymbol), same_screen YES,<br />&nbsp&nbsp;&nbsp;&nbsp;XLookupString gives 0 bytes:<br />&nbsp&nbsp;&nbsp;&nbsp;XFilterEvent returns: False</code></div><br />Как видите, в обоих сообщениях упоминается некий keycode (выделено жирным). Это именно то, зачем мы запускали xev. Теперь осталось только дописать в конфиг строку, описывающую, какое именно действие выполняет данная клавиша. В моём случае это была клавиша включения/выключения звука. В секции config пишем:<br /><br /><div class="code"><code>&lt;Mute   keycode="160"/&gt;</code></div><br />Тут всё просто: действие включения/выключения звука я назвал Mute, а в кавычки написал кейкод клавиши. Сделайте то же самое с другими кнопками, которые вы хотите задействовать.<br /><br />У меня секция config имеет следующий вид:<br /><br /><div class="code"><code>&lt;config model="A4Tech KL-7MU"&gt;<br />&nbsp;&nbsp;&lt;PrevTrack  keycode="144"/&gt;<br />&nbsp;&nbsp;&lt;Stop       keycode="164"/&gt;<br />&nbsp;&nbsp;&lt;Play       keycode="162"/&gt;<br />&nbsp;&nbsp;&lt;NextTrack  keycode="153"/&gt;<br />&nbsp;&nbsp;&lt;VolUp      keycode="176"/&gt;<br />&nbsp;&nbsp;&lt;VolDown    keycode="174"/&gt;<br />&nbsp;&nbsp;&lt;Mute       keycode="160"/&gt;<br />&lt;/config&gt;</code></div><br />Здесь описан только блок клавиш, относящихся к мультимедиа — мне пока что ничего другого и не нужно.<br /><br />Теперь осталась чистая формальность — описать, кто изготовил этот конфиг. Для этого пишем нечто вроде этого:<br /><br /><div class="code"><code>&lt;contributor&gt;<br />&nbsp;&nbsp;&lt;name&gt;Programmaster&lt;/name&gt;<br />&nbsp;&nbsp;&lt;email&gt;eual.jp@gmail.com&lt;/email&gt;<br />&lt;/contributor&gt;</code></div><br />Ну вот, такой конфиг не стыдно и людям показать!<br /><br />Перейдём ко второй части повествования — правке <code>/etc/hotkeys.conf</code><br /><br />Закомментируйте (поставьте знак "#" в начале строки) все незакомментированные строки файла — нам не нужно, чтобы какие–то дефолтные опции помешали нашим. Итак, первым делом укажем тип клавиатуры, которую мы используем:<br /><br /><div class="code"><code>Kbd=a4tech_kl-7mu</code></div><br />Вы сможете указывать любой другой тип клавиатуры при запуске hotkeys, но по умолчанию будет использоваться указанный здесь. Обратите внимание, что тип клавиатуры совпадает с именем файла в <code>/usr/share/hotkeys</code>, но расширение <code>.def</code> не указывается.<br /><br />Дальше следует указать конкретные команды, которые будут выполнятся при нажатии кнопок. Например, в конфиге клавиатуры я назначил кнопке с кейкодом 162 приостанавливать/запускать воспроизведение (действие я назвал Play). Теперь, чтобы это действие реально выполнялось, мне надо дописать в конф вот такую вот простую строку:<br /><br /><div class="code"><code>Play=mpc toggle</code></div><br />Здесь всё просто: действие<b>=</b>строка для консоли, которая выполняет это действие. В итоге у меня получился вот такой вот набор команд:<br /><br /><div class="code"><code>PrevTrack=mpc prev<br />Play=mpc toggle<br />Stop=mpc stop<br />NextTrack=mpc next<br />VolUp=mpc volume +5<br />VolDown=mpc volume -5</code></div><br />У вас, естественно, может получится что-то другое — плееры есть разные. Если у вас amaroK, советую посмотреть в сторону DCOP для управления им из консоли.<br /><br />Надеюсь, эта статья помогла вам. Удачи! ;)

<h3 id='hakyll-convert-comments-title'>Comments (migrated from Blogger)</h3>
<div class='hakyll-convert-comment'>
<p class='hakyll-convert-comment-date'>On 2009-04-03T20:54:00.000+03:00, Анонимный wrote:</p>
<p class='hakyll-convert-comment-body'>
а как привязать действие на сочетание клавишь.. к примеру на super_l+Up<BR/>в xev сочетания кнопок отоброжаеться только как state<BR/>но как это прописать в конфиг? т.е. как сделать что бы это все заработало :)
</p>
</div>

<div class='hakyll-convert-comment'>
<p class='hakyll-convert-comment-date'>On 2009-04-03T21:09:00.000+03:00, Programmaster wrote:</p>
<p class='hakyll-convert-comment-body'>
Хм… Сочетания клавиш я в hotkeys не привязывал (и не уверен, что это возможно).
</p>
</div>



